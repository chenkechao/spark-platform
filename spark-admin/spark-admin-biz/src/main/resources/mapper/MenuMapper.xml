<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.spark.platform.adminbiz.dao.menu.MenuDao">

    <!--查询当前用户菜单-->
    <select id="findMenuByUserName" resultType="Menu">
        SELECT
        m.*
        FROM
        sys_menu m
        JOIN (
        SELECT DISTINCT
        ra.AUTH_ID
        FROM
        sys_user_role ur
        JOIN sys_role_auth ra ON ur.ROLE_ID = ra.ROLE_ID
        JOIN sys_user u ON ur.USER_ID = u.ID
        WHERE
        u.USERNAME = 'admin'
        ) AS um ON m.id = um.AUTH_ID
        WHERE
        m.del_flag = 0
        <if test="filterType != null and filterType != ''">
            AND m.type !=#{filterType}
        </if>
    </select>

    <!--查询当前用户菜单-->
    <select id="findMenuVueByUserName" resultType="com.spark.platform.adminapi.vo.MenuVue">
        SELECT
        m.*,
        m.name AS "Meta.title",
        m.icon AS "Meta.icon"
        FROM
        sys_menu m
        JOIN (
        SELECT DISTINCT
        ra.AUTH_ID
        FROM
        sys_user_role ur
        JOIN sys_role_auth ra ON ur.ROLE_ID = ra.ROLE_ID
        JOIN sys_user u ON ur.USER_ID = u.ID
        WHERE
        u.USERNAME = 'admin'
        ) AS um ON m.id = um.AUTH_ID
        WHERE
        m.del_flag = 0
        AND m.type != '1'
    </select>

    <!--查询当前用户权限-->
    <select id="findAuthByUserId" resultType="Menu">
        SELECT
            m.*
        FROM
            sys_menu m
            JOIN (
                SELECT DISTINCT ra.AUTH_ID
                FROM sys_user_role ur JOIN sys_role_auth ra ON ur.ROLE_ID = ra.ROLE_ID
                WHERE ur.USER_ID = #{userId}
            ) AS um ON m.id = um.AUTH_ID
        WHERE
            m.permission is not null AND m.permission !=''
    </select>


</mapper>